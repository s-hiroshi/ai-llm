import torch

# サンプル：4つの単語（T=4）、それぞれの特徴が2次元（C=2）のデータ
T, C = 4, 2
x = torch.randn(T, C) # ランダムなデータ（単語のようなもの）

# 目的：各行（単語）において、自分自身と「それ以前のすべて」の平均をとりたい
# これが「過去の文脈を混ぜる」という操作の第一歩です

# 効率的な計算のための「三角行列」を作成
# 下半分が1、上半分が0の行列
tril = torch.tril(torch.ones(T, T))
# 行ごとの和が1になるように正規化（＝平均をとるための重み）
weights = tril / tril.sum(1, keepdim=True)

# 行列の掛け算で、過去の情報の平均を一気に計算！
out = weights @ x

print("--- 元のデータ (各単語の情報) ---")
print(x)
print("\n--- 過去の文脈を混ぜた後のデータ ---")
print(out)